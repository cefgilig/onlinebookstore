<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
    <title>Flourish and Blotts Bookshop</title>
</head>
<body style="background-color: lightcoral;">
    <div class="container fluid bg-light text-center"><h2>Flourish and Blotts Bookshop</h2></div>
    <nav class="navbar navbar-expand-lg navbar-light bg-light p-2">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Shopping cart</a>
            <div class="navbar navbar-collapse">
                <ul class="navbar-nav me-auto">
                   <!-- <li class="nav-item"></li> -->
                </ul>
                <ul class="navbar-nav me-auto">
                    <!-- <li class="nav-item"></li> -->
                 </ul>
                 <ul class="navbar-nav me-auto">
                    <!-- <li class="nav-item"></li> -->
                 </ul>
                 <span class="navbar-text">Total shopping cart vlaue: ₱ <span class="totalAmount">0</span></span> 
            </div>
        </div>
    </nav>
    <div class="container-fluid">
        <div class="card mx-auto mt-5 shadow-lg rounded-0" style="width: 40rem;">
            <div class="card-header">
                    <p>Your Cart</p>
            </div>
            <div class="card-body">
                <table class="table table-primary">
                    <thead>
                    <tr>
                        <th>#</th>
                        <th>Item</th>
                        <th>Price</th>
                        <th class="text-center">Quantity</th>
                    </tr>
                    </thead>
                    <tbody class="table-light">
                        <tr>
                            <td>1</td>
                            <td><img src="books/book1.jpeg" style="width: 65px"><br><b>Harry Potter and the Sorcerer's Stone</b><br>J.K. Rowling<br>Paperback</td>
                            <td>
                                ₱ <span class="price">150</span>
                                <input type="hidden" name="txtPrice" value="150">
                                <input type="hidden" name="totalTxtPrice" value="0">
                            </td>
                            <td class="text-center">
                                <i class="bi bi-cart-dash text-danger"></i>&nbsp;<input name="item" value="0" size="2" class="text-center">&nbsp;<i class="bi bi-cart-plus-fill text-success"></i>
                                <input type="hidden" name="txtItem" value="0">
                            </td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td><img src="books/book2.jpg" style="width: 65px"><br><b>Harry Potter and the Chamber of Secrets</b><br>J.K. Rowling<br>Paperback</b></td>
                            <td>
                                ₱ <span class="price">175</span>
                                <input type="hidden" name="txtPrice" value="175">
                                <input type="hidden" name="totalTxtPrice" value="0">
                            </td>
                            <td class="text-center">
                                <i class="bi bi-cart-dash text-danger"></i>&nbsp;<input name="item" value="0" size="2" class="text-center">&nbsp;<i class="bi bi-cart-plus-fill text-success"></i>
                                <input type="hidden" name="txtItem" value="0">
                            </td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td><img src="books/book3.jpeg" style="width: 65px"><br><b>Harry Potter and the Prisoner of Azkaban</b><br>J.K. Rowling<br>Paperback</b></td>
                            <td>
                                ₱ <span class="price">205</span>
                                <input type="hidden" name="txtPrice" value="205">
                                <input type="hidden" name="totalTxtPrice" value="0">
                            </td>
                            <td class="text-center">
                                <i class="bi bi-cart-dash text-danger"></i>&nbsp;<input name="item" value="0" size="2" class="text-center">&nbsp;<i class="bi bi-cart-plus-fill text-success"></i>
                                <input type="hidden" name="txtItem" value="0">
                            </td>
                        </tr>
                        <tr>
                            <td>4</td>
                            <td><img src="books/book4.jpeg" style="width: 65px"><br><b>Harry Potter and the Goblet of Fire</b><br>J.K. Rowling<br>Paperback</b></td>
                            <td>
                                ₱ <span class="price">225</span>
                                <input type="hidden" name="txtPrice" value="225">
                                <input type="hidden" name="totalTxtPrice" value="0">
                            </td>
                            <td class="text-center">
                                <i class="bi bi-cart-dash text-danger"></i>&nbsp;<input name="item" value="0" size="2" class="text-center">&nbsp;<i class="bi bi-cart-plus-fill text-success"></i>
                                <input type="hidden" name="txtItem" value="0">
                            </td>
                        </tr>
                        <tr>
                            <td colspan=2 class="text-end">Total Amount : </td>
                            <td>₱ <span class="totalAmount">0</span></td>
                            <td>Total Quantity : <span class="totalQuantity">0</span></td>
                        </tr>
                    </tbody>
                </table>
                <button type="button" class="btn btn-danger text-center btn-left" id="clear-cart" onClick={clearCart}>Clear Cart</button>
            </div>

        </div>
        <br>
        <div class="text-center">
            <button type="button" class="btn btn-primary btn-lg">Proceed to Checkout</button>
        </div>

    </div>
    <script>
        var totalAmount = document.querySelectorAll(".totalAmount");
        var amountByItem = document.querySelectorAll("input[name=totalTxtPrice]");
        var totalItem = document.querySelector(".totalQuantity");
        var itemCountByEachProd = document.querySelectorAll("input[name=item]");

        document.querySelectorAll(".bi-cart-plus-fill").forEach(item => {

            item.addEventListener("click",function(){
                addItemToCart(item,"ICON");
            })

        })

        document.querySelectorAll(".bi-cart-dash").forEach(item => {

item.addEventListener("click",function(){
    removeItemFromCart(item);
})

})

document.querySelectorAll("input[name=item]").forEach(item => {

item.addEventListener("input",function(){
    addItemToCart(item, "INPUT");
})

})


        function addItemToCart(item,callFrom){

            var closetTr = item.closest("td").parentNode;
            var closestPrice = closetTr.cells[2].querySelector("input[name=txtPrice]").value;
            var closestTotalPrice = closetTr.cells[2].querySelector("input[name=totalTxtPrice]");

            var itemCount = item.closest("td").querySelector("input[name=item]");
            if(callFrom == "ICON"){
            itemCount.value = parseFloat(itemCount.value)+1;
            }else{
                itemCount.value = parseFloat(itemCount.value) > 0 ? parseFloat(itemCount.value) : 0;
            }
            closestTotalPrice.value = parseFloat(closestPrice) * parseFloat(itemCount.value)

            var tempTotalAmount = 0;
            amountByItem.forEach(item => {
            tempTotalAmount = tempTotalAmount + parseFloat(item.value)
            })
            totalAmount.forEach(item => {
                item.innerHTML = tempTotalAmount;

            })

            var tempItemCount = 0;
            itemCountByEachProd.forEach(item=>{
                tempItemCount = tempItemCount + parseFloat(item.value);
            })

            totalItem.innerHTML = tempItemCount;
            
        }

        $("#clear-cart").click(function(event){
                shoppingCart.clearCart();
                displayCart();
            });
            
        function removeItemFromCart(item){

var closetTr = item.closest("td").parentNode;
var closestPrice = closetTr.cells[2].querySelector("input[name=txtPrice]").value;
var closestTotalPrice = closetTr.cells[2].querySelector("input[name=totalTxtPrice]");

var itemCount = item.closest("td").querySelector("input[name=item]");

itemCount.value = parseFloat(itemCount.value) > 0 ? parseFloat(itemCount.value)-1 : 0;
closestTotalPrice.value = parseFloat(closestPrice) * parseFloat(itemCount.value)

var tempTotalAmount = 0;
amountByItem.forEach(item => {
tempTotalAmount = tempTotalAmount + parseFloat(item.value)
})
totalAmount.forEach(item => {
    item.innerHTML = tempTotalAmount;

})

var tempItemCount = 0;
itemCountByEachProd.forEach(item=>{
    tempItemCount = tempItemCount + parseFloat(item.value);
})

totalItem.innerHTML = tempItemCount;

}
    </script>
</body>
</html>